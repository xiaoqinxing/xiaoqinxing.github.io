<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>makefile基础和编译模板 | 清新的日子</title><meta name="keywords" content="c/c++,Makefile"><meta name="author" content="xiaoqinxing"><meta name="copyright" content="xiaoqinxing"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="如何进行Makefile的编写？如何编译动态库？如何引用动态库？">
<meta property="og:type" content="article">
<meta property="og:title" content="makefile基础和编译模板">
<meta property="og:url" content="https://www.qinxing.xyz/posts/21c9d9a6/index.html">
<meta property="og:site_name" content="清新的日子">
<meta property="og:description" content="如何进行Makefile的编写？如何编译动态库？如何引用动态库？">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://image.qinxing.xyz/20200317000739.png">
<meta property="article:published_time" content="2019-03-12T16:00:00.000Z">
<meta property="article:modified_time" content="2021-03-09T15:46:13.098Z">
<meta property="article:author" content="xiaoqinxing">
<meta property="article:tag" content="c&#x2F;c++">
<meta property="article:tag" content="Makefile">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://image.qinxing.xyz/20200317000739.png"><link rel="shortcut icon" href="/img/pwaicons/favicon.ico"><link rel="canonical" href="https://www.qinxing.xyz/posts/21c9d9a6/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//pingjs.qq.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="preconnect" href="//zz.bdstatic.com"/><meta name="google-site-verification" content="Osf5KuSN_EP3Uk2LaoVo568hFQb2-0VdKOOoJnxTC5g"/><link rel="manifest" href="/manifest.json"/><meta name="msapplication-TileColor" content="#fff"/><link rel="apple-touch-icon" sizes="180x180" href="/img/pwaicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/img/pwaicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/img/pwaicons/favicon-16x16.png"/><link rel="mask-icon" href="/img/pwaicons/safari-pinned-tab.svg" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?b21df310b77ed0cbce2ac9993f8a13f5";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>var _mtac = {};
(function() {
    var mta = document.createElement("script");
    mta.src = "//pingjs.qq.com/h5/stats.js?v2.0.4";
    mta.setAttribute("name", "MTAH5");
    mta.setAttribute("sid", "66531382");
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(mta, s);
})();
</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '4.2.0',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":100,"languages":{"author":"作者: xiaoqinxing","link":"链接: ","source":"来源: 清新的日子","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2021-03-09 23:46:13'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
  }
}

var autoChangeMode = 'false'
var t = saveToLocal.get('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (saveToLocal.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://image.qinxing.xyz/dac12727b0ba786043e8cdefd90f1c35_1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">101</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">110</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">23</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa fa-comment"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 收藏</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fa fa-book"></i><span> 书籍</span></a></li><li><a class="site-page" href="/website/"><i class="fa-fw fa fa-tag"></i><span> 网站</span></a></li></ul></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#基础知识"><span class="toc-number">1.</span> <span class="toc-text">基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Makefile-gcc的参数"><span class="toc-number">1.1.</span> <span class="toc-text">Makefile gcc的参数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#android-mk"><span class="toc-number">2.</span> <span class="toc-text">android.mk</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#基本概念"><span class="toc-number">2.0.1.</span> <span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#举例"><span class="toc-number">2.0.2.</span> <span class="toc-text">举例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编译"><span class="toc-number">2.0.3.</span> <span class="toc-text">编译</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#变量"><span class="toc-number">2.0.4.</span> <span class="toc-text">变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Android-mk变量"><span class="toc-number">2.0.5.</span> <span class="toc-text">Android.mk变量</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Makefile模板"><span class="toc-number">3.</span> <span class="toc-text">Makefile模板</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#文件目录结构："><span class="toc-number">3.1.</span> <span class="toc-text">文件目录结构：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dynamiclib目录"><span class="toc-number">3.2.</span> <span class="toc-text">dynamiclib目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#加载"><span class="toc-number">3.3.</span> <span class="toc-text">加载</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#在编译应用程序时加载动态库"><span class="toc-number">3.3.0.1.</span> <span class="toc-text">在编译应用程序时加载动态库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#在应用程序执行时加载动态库"><span class="toc-number">3.3.0.2.</span> <span class="toc-text">在应用程序执行时加载动态库</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#c-c-混合编译"><span class="toc-number">3.3.1.</span> <span class="toc-text">c&#x2F;c++ 混合编译</span></a></li></ol></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://image.qinxing.xyz/20200317000739.png)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">清新的日子</a></span><span id="menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa fa-comment"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 收藏</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fa fa-book"></i><span> 书籍</span></a></li><li><a class="site-page" href="/website/"><i class="fa-fw fa fa-tag"></i><span> 网站</span></a></li></ul></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">makefile基础和编译模板</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2019-03-12T16:00:00.000Z" title="发表于 2019-03-13 00:00:00">2019-03-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-03-09T15:46:13.098Z" title="更新于 2021-03-09 23:46:13">2021-03-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0/%E7%BC%96%E7%A8%8B/">编程</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0/%E7%BC%96%E7%A8%8B/c-c/">c/c++</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">759</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>3分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><html><head></head><body><blockquote>
<p>如何进行Makefile的编写？<br>如何编译动态库？<br>如何引用动态库？</p>
</blockquote>
<h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><h2 id="Makefile-gcc的参数"><a href="#Makefile-gcc的参数" class="headerlink" title="Makefile gcc的参数"></a>Makefile gcc的参数</h2><p>-Wall： 是打开警告开关，</p>
<p>-O：    代表默认优化，可选：-O0不优化，-O1低级优化，-O2中级优化，-O3高级优化，-Os代码空间优化。</p>
<p>-g：     是生成调试信息，生成的可执行文件具有和源代码关联的可调试的信息。 </p>
<p>-I（大写的i）：代表后面跟的目录为第一个寻找<strong>头文件</strong>的目录</p>
<p>-L：     代表后面跟的目录为第一个寻找<strong>库文件</strong>的目录</p>
<p>-l（小写的L）：表示libxxx.so<strong>库文件</strong></p>
<p>-static：  静态编译的</p>
<p>-c（小写）：    只编译，不链接</p>
<p>-C（大写）：   切换到指定目录再执行 make 过程，makefile 在这个指定目录里面，然后返回到当前目录继续读入、执行当前的Makefile。</p>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">gcc -o hello hello.c -I /home/hello/include -L /home/hello/lib -lworld</span><br><span class="line"></span><br><span class="line">上面这句表示在编译hello.c时：</span><br><span class="line"></span><br><span class="line">-I /home/hello/include表示将/home/hello/include目录作为第一个寻找头文件的目录，寻找的顺序是：/home/hello/include-->/usr/include-->/usr/local/include</span><br><span class="line"></span><br><span class="line">-L /home/hello/lib表示将/home/hello/lib目录作为第一个寻找库文件的目录，寻找的顺序是：/home/hello/lib-->/lib-->/usr/lib-->/usr/local/lib</span><br><span class="line"></span><br><span class="line">-lworld表示在上面的lib的路径中寻找libworld.so动态库文件（如果gcc编译选项中加入了“-static”表示寻找libworld.a静态库文件）</span><br></pre></td></tr></tbody></table></figure>

<h1 id="android-mk"><a href="#android-mk" class="headerlink" title="android.mk"></a>android.mk</h1><p>官方介绍：<a href="http://android.mk/" target="_blank" rel="noopener">http://android.mk/</a></p>
<h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><p>可以生成一下几个类别：</p>
<table>
<thead>
<tr>
<th>JAVA代码的</th>
<th>C/C++代码的</th>
</tr>
</thead>
<tbody><tr>
<td>JAR包</td>
<td>二进制可执行文件：ELF (BUILD_EXECUTABLE)</td>
</tr>
<tr>
<td>应用程序：APK</td>
<td>动态库：.so　　         (BUILD_SHARED_LIBRARY)</td>
</tr>
<tr>
<td></td>
<td>静态库：.a                (BUILD_STATIC_LIBRARY)</td>
</tr>
</tbody></table>
<p>常用的变量：</p>
<table>
<thead>
<tr>
<th><code>名字</code></th>
<th>含义</th>
<th>常用的方式</th>
</tr>
</thead>
<tbody><tr>
<td><code>LOCAL_PATH</code></td>
<td>当前模块的相对路径</td>
<td>LOCAL_PATH := $(call my-dir)</td>
</tr>
<tr>
<td><code>LOCAL_MODULE</code></td>
<td>编译生成的目标名称</td>
<td>LOCAL_MODULE := test</td>
</tr>
<tr>
<td>LOCAL_SRC_FILES</td>
<td>编译该模块需要的源文件</td>
<td>LOCAL_SRC_FILES := test.c</td>
</tr>
<tr>
<td>LOCAL_C_INCLUDES</td>
<td>包含C的头文件目录</td>
<td></td>
</tr>
<tr>
<td>LOCAL_SHARED_LIBRARIES</td>
<td>导入共享库</td>
<td>LOCAL_SHARED_LIBRARIES += liblog</td>
</tr>
</tbody></table>
<h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">hejin@desk-ubuntu:/home/desk/myandroid$ ls external/test/</span><br><span class="line">Android.mk  test2.c  test2.h  test.c</span><br></pre></td></tr></tbody></table></figure>



<p>分别查看四个源文件的内容：</p>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">hejin@desk-ubuntu:/home/desk/myandroid$ cat external/test/test.c</span><br><span class="line">#include "stdio.h"</span><br><span class="line">#include "test2.h"</span><br><span class="line">int main(){</span><br><span class="line">        printf("hello world\n");</span><br><span class="line">        test2();</span><br><span class="line">        return 0;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">hejin@desk-ubuntu:/home/desk/myandroid$ cat external/test/test2.c</span><br><span class="line">#include"stdio.h"</span><br><span class="line"></span><br><span class="line">void test2(){</span><br><span class="line">        printf("hello test2\n");</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">hejin@desk-ubuntu:/home/desk/myandroid$ cat external/test/test2.h</span><br><span class="line">void test2();</span><br></pre></td></tr></tbody></table></figure>

<p><strong>Android.mk:</strong></p>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">hejin@desk-ubuntu:/home/desk/myandroid$ cat external/test/Android.mk</span><br><span class="line">LOCAL_PATH := $(call my-dir)      #定义了当前模块的相对路径</span><br><span class="line">include $(CLEAR_VARS)             #清空当前环境变量， 除了LOCAL_PATH</span><br><span class="line">LOCAL_MODULE := libtest              #编译生成的目标名称</span><br><span class="line">LOCAL_SRC_FILES := test.c \       #编译该模块需要的源文件</span><br><span class="line">                   test2.c</span><br><span class="line">include $(BUILD_SHARED_LIBRARY)       #编译所生成的目标文件格（在这里是动态库文件）</span><br></pre></td></tr></tbody></table></figure>

<h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">hejin@desk-ubuntu:/home/desk/myandroid$ source build/envsetup.sh</span><br><span class="line">hejin@desk-ubuntu:/home/desk/myandroid$ lunch</span><br><span class="line">hejin@desk-ubuntu:/home/desk/myandroid$ mmm external/test/</span><br><span class="line">============================================</span><br><span class="line">PLATFORM_VERSION_CODENAME=REL</span><br><span class="line">PLATFORM_VERSION=5.1.1</span><br><span class="line">TARGET_PRODUCT=sabresd_6dq</span><br><span class="line">TARGET_BUILD_VARIANT=user</span><br><span class="line">TARGET_BUILD_TYPE=release</span><br><span class="line">TARGET_BUILD_APPS=</span><br><span class="line">TARGET_ARCH=arm</span><br><span class="line">TARGET_ARCH_VARIANT=armv7-a-neon</span><br><span class="line">TARGET_CPU_VARIANT=cortex-a9</span><br><span class="line">TARGET_2ND_ARCH=</span><br><span class="line">TARGET_2ND_ARCH_VARIANT=</span><br><span class="line">TARGET_2ND_CPU_VARIANT=</span><br><span class="line">HOST_ARCH=x86_64</span><br><span class="line">HOST_OS=linux</span><br><span class="line">HOST_OS_EXTRA=Linux-3.16.0-30-generic-x86_64-with-Ubuntu-14.04-trusty</span><br><span class="line">HOST_BUILD_TYPE=release</span><br><span class="line">BUILD_ID=2.1.0-ga-rc3</span><br><span class="line">OUT_DIR=out</span><br><span class="line">============================================</span><br><span class="line">No private recovery resources for TARGET_DEVICE sabresd_6dq</span><br><span class="line">make: Entering directory `/home/desk/myandroid'</span><br><span class="line">target thumb C: test <= external/test/test.c</span><br><span class="line">target thumb C: test <= external/test/test2.c</span><br><span class="line">target Executable: test (out/target/product/sabresd_6dq/obj/EXECUTABLES/test_intermediates/LINKED/test)</span><br><span class="line">target Symbolic: test (out/target/product/sabresd_6dq/symbols/system/bin/test)    </span><br><span class="line">target Strip: test (out/target/product/sabresd_6dq/obj/EXECUTABLES/test_intermediates/test)</span><br><span class="line">Install: out/target/product/sabresd_6dq/system/bin/test    //将可执行文件安装到这个目录下</span><br><span class="line">make: Leaving directory `/home/desk/myandroid'</span><br><span class="line"></span><br><span class="line">#### make completed successfully (1 seconds) ####</span><br></pre></td></tr></tbody></table></figure>

<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>makefile文件有一个基础的东西就是变量。大家可以自己了解下。这里我们说说android.mk这个变量的不同的地方。主要是用它来做代码管理。</p>
<p>首先在执行make文件的时候这些变量是全局有效的，一些公共的变量会通过include $(CLEAR_VARS)给清除掉。我们这里主要是添加自己的变量。我们在使用自己定义变量的时候有两种情况，一种是在mk中使用，一种是在cpp中使用。注意java不支持的。这两种情况有点不同，请注意。</p>
<p>首先我们得定义这个变量，一般来讲都是在产品的BoardConfig.mk中定义，例如：</p>
<figure class="highlight makefile"><table><tbody><tr><td class="code"><pre><span class="line">TARGET_MEMORY_STYLE := TARGET_MEM_256MB</span><br><span class="line"><span class="comment">#TARGET_MEMORY_STYLE := TARGET_MEM_256MB_ST</span></span><br><span class="line"><span class="comment">#TARGET_MEMORY_STYLE := TARGET_MEM_512MB</span></span><br><span class="line"><span class="comment">#TARGET_MEMORY_STYLE := TARGET_MEM_512MB_ST</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># board-specific configuration</span></span><br><span class="line">BOARD_OPENCORE_FLAGS := -DTELECHIPS_ALSA</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(BOARD_KERNEL_BASE)</span>,0x40000000)</span><br><span class="line">BOARD_MEM_FLAGS := -DTCC_MEM_256MB</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">BOARD_MEM_FLAGS := -DTCC_MEM_512MB</span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></tbody></table></figure>

<p>这里总共有两个我们经常用的东西。</p>
<p><strong>第一：</strong><br>如果是mk中使用，定义如前四行就可以了。  </p>
<p>变量 := 字符串</p>
<p>在mk中的使用方法就像后面例子一样。</p>
<figure class="highlight makefile"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">ifeq</span>($(变量),对比值)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>第二：</strong>如果你想在cpp中使用，请定义方式如下：  </p>
<p>变量 := -D+变量名</p>
<p>如后面几行示例一样的。</p>
<p>如果想在cpp中应用，首先必须在cpp对于的mk文件中，声明如下<br>LOCAL_CFLAGS += $(BOARD_MEM_FLAGS)</p>
<p>格式：   LOCAL_CFLAGS += $(变量)</p>
<p>然后它的cpp中就可以引用如下：<br>此时去掉了-D前缀。</p>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">ifdef TCC_MEM_512MB</span><br><span class="line">......</span><br><span class="line">endif</span><br></pre></td></tr></tbody></table></figure>
<h3 id="Android-mk变量"><a href="#Android-mk变量" class="headerlink" title="Android.mk变量"></a>Android.mk变量</h3><p>这些是您在Android.mk文件中常见的变量，按字母顺序列出。首先，关于变量命名的注释：</p>
<ul>
<li><p><strong>LOCAL_</strong> - 这些变量是按模块设置的。它们被行清除<code>include $(CLEAR_VARS)</code>，因此您可以在包含该文件后依赖它们为空。您将在大多数模块中使用的大多数变量都是LOCAL_变量。</p>
</li>
<li><p><strong>PRIVATE_</strong> - 这些变量是特定于make-target的变量。这意味着它们只能在该模块的命令中使用。这也意味着他们不可能从你的后面的模块背后改变。此 <a href="http://www.gnu.org/software/make/manual/make.html#Target_002dspecific" target="_blank" rel="noopener">make链接提供了</a> 有关特定于目标的变量的更多信息。</p>
</li>
<li><p><strong>HOST_</strong>和<strong>TARGET_</strong> - 包含特定于主机或目标版本的目录和定义。不要在makefile中设置以HOST_或TARGET_开头的变量。</p>
</li>
<li><p><strong>BUILD_</strong>和<strong>CLEAR_VARS</strong> - 包含要包含的明确定义的模板makefile的名称。一些示例是CLEAR_VARS和BUILD_HOST_PACKAGE。</p>
</li>
<li><p>任何其他名称都是公平游戏，供您在Android.mk中使用。但是，请记住，这是一个非递归构建系统，因此您的变量可能会被稍后包含的另一个Android.mk更改，并且在执行规则/模块的命令时会有所不同。</p>
</li>
<li><p><strong>定义C/CPP编译的宏时，注意格式，后面=1，不能带空格！</strong></p>
<p>LOCAL_CFLAGS += -DLIBUTILS_NATIVE=1</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">LOCAL_AAPT_FLAGS</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_ACP_UNAVAILABLE</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_ADDITIONAL_JAVA_DIR</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_AIDL_INCLUDES</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_ALLOW_UNDEFINED_SYMBOLS</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_ARM_MODE</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_ASFLAGS</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_ASSET_DIR</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_ASSET_FILES</td>
<td>在Android.mk文件中，<code>include $(BUILD_PACKAGE)</code>将此文件设置为您希望在应用程序中内置的文件集。通常：<code>LOCAL_ASSET_FILES += $(call find-subdir-assets)</code></td>
</tr>
<tr>
<td align="left">LOCAL_BUILT_MODULE_STEM</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_C_INCLUDES</td>
<td>指示C / C ++编译器查找头文件的其他目录。这些路径根植于树的顶部。<code>LOCAL_PATH</code>如果您在包含路径中包含您想要的子目录，请使用 此选项。例如：<code>LOCAL_C_INCLUDES += extlibs/zlib-1.2.3LOCAL_C_INCLUDES += $(LOCAL_PATH)/src</code>您不应该添加include的子目录 <code>LOCAL_C_INCLUDES</code>，而应该在<code>#include</code>语句中引用这些文件及其子目录。例如：<code>#include <utils/KeyedVector.h></code> 不 <code>#include <KeyedVector.h></code></td>
</tr>
<tr>
<td align="left">LOCAL_CC</td>
<td>如果要为此模块使用不同的C编译器，请将LOCAL_CC设置为编译器的路径。如果LOCAL_CC为空，则使用相应的默认编译器。</td>
</tr>
<tr>
<td align="left">LOCAL_CERTIFICATE</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_CFLAGS</td>
<td><strong>如果您有其他标志要传递到C或C ++编译器，请在此处添加它们。例如：</strong><code>LOCAL_CFLAGS += -DLIBUTILS_NATIVE=1</code></td>
</tr>
<tr>
<td align="left">LOCAL_CLASSPATH</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_COMPRESS_MODULE_SYMBOLS</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_COPY_HEADERS</td>
<td>要复制到安装的文件集包括树。你还必须提供<code>LOCAL_COPY_HEADERS_TO</code>。这会消失，因为复制标题会混淆错误消息，并可能导致人们编辑这些标题而不是正确标题。它还可以更容易地在系统中执行错误的分层，我们希望避免这种分层。我们也没有使用C / C ++ SDK，因此没有最终要求复制任何标头。</td>
</tr>
<tr>
<td align="left">LOCAL_COPY_HEADERS_TO</td>
<td>“include”中的目录，用于复制<code>LOCAL_COPY_HEADERS</code>to中列出的标题 。这会消失，因为复制标题会混淆错误消息，并可能导致人们编辑这些标题而不是正确标题。它还可以更容易地在系统中执行错误的分层，我们希望避免这种分层。我们也没有使用C / C ++ SDK，因此没有最终要求复制任何标头。</td>
</tr>
<tr>
<td align="left">LOCAL_CPP_EXTENSION</td>
<td>如果您的C ++文件以“ <code>.cpp</code>” 之外的其他内容结尾，则可以在此处指定自定义扩展名。例如：<code>LOCAL_CPP_EXTENSION := .cc</code>请注意，给定模块的所有C ++文件必须具有相同的扩展名; 目前无法混合不同的扩展。</td>
</tr>
<tr>
<td align="left">LOCAL_CPPFLAGS</td>
<td>如果还有其他标志<em>只</em>传递给C ++编译器，请在此处添加。例如：<code>LOCAL_CPPFLAGS += -ffriend-injection``LOCAL_CPPFLAGS</code>保证<code>LOCAL_CFLAGS</code> 在编译行之后，因此您可以使用它来覆盖中列出的标志 <code>LOCAL_CFLAGS</code></td>
</tr>
<tr>
<td align="left">LOCAL_CXX</td>
<td>如果要为此模块使用不同的C ++编译器，请将LOCAL_CXX设置为编译器的路径。如果LOCAL_CXX为空，则使用相应的默认编译器。</td>
</tr>
<tr>
<td align="left">LOCAL_DX_FLAGS</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_EXPORT_PACKAGE_RESOURCES</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_FORCE_STATIC_EXECUTABLE</td>
<td>如果您的可执行文件应静态链接，请设置 <code>LOCAL_FORCE_STATIC_EXECUTABLE:=true</code>。我们以静态形式存在一个非常短的库列表（目前只有libc）。这实际上只用于根文件系统上/ sbin中的可执行文件。</td>
</tr>
<tr>
<td align="left">LOCAL_GENERATED_SOURCES</td>
<td>添加到的文件<code>LOCAL_GENERATED_SOURCES</code>将自动生成，然后在构建模块时链接。有关示例，请参阅<a href="http://android.mk/#custom-tools" target="_blank" rel="noopener">自定义工具</a>模板makefile。</td>
</tr>
<tr>
<td align="left">LOCAL_INSTRUMENTATION_FOR</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_INSTRUMENTATION_FOR_PACKAGE_NAME</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_INTERMEDIATE_SOURCES</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_INTERMEDIATE_TARGETS</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_IS_HOST_MODULE</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_JAR_MANIFEST</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_JARJAR_RULES</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_JAVA_LIBRARIES</td>
<td>链接Java应用程序和库时，<code>LOCAL_JAVA_LIBRARIES</code> 指定要包含的Java类集。目前有两个：<code>core</code>和<code>framework</code>。在大多数情况下，它看起来像这样：<code>LOCAL_JAVA_LIBRARIES := core framework</code>请注意，<code>LOCAL_JAVA_LIBRARIES</code>使用“ <code>include $(BUILD_PACKAGE)</code>” 构建APK时，无需进行设置（并且不允许）。将自动包含适当的库。</td>
</tr>
<tr>
<td align="left">LOCAL_JAVA_RESOURCE_DIRS</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_JAVA_RESOURCE_FILES</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_JNI_SHARED_LIBRARIES</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_LDFLAGS</td>
<td>您可以通过设置将其他标志传递给链接器 <code>LOCAL_LDFLAGS</code>。请记住，参数的顺序对于ld非常重要，因此请测试您在所有平台上执行的操作。</td>
</tr>
<tr>
<td align="left">LOCAL_LDLIBS</td>
<td><code>LOCAL_LDLIBS</code>允许您指定不属于可执行文件或库的构建的其他库。在-lxxx格式中指定所需的库; 它们直接传递给链接线。但是，请记住，不会为这些库生成依赖关系。它在您希望使用主机上预安装的库的模拟器构建中最有用。链接器（ld）是一个特别挑剔的野兽，所以如果你做鬼鬼祟祟的话，有时候必须在这里传递其他标志。一些例子：<code>LOCAL_LDLIBS += -lcurses -lpthreadLOCAL_LDLIBS += -Wl,-z,origin</code></td>
</tr>
<tr>
<td align="left">LOCAL_MODULE</td>
<td><code>LOCAL_MODULE</code>是应该从Android.mk生成的名称。例如，对于libkjs，它<code>LOCAL_MODULE</code>是“libkjs”（构建系统添加适当的后缀 - .so .dylib .dll）。对于应用程序模块，请使用<code>LOCAL_PACKAGE_NAME</code>而不是 <code>LOCAL_MODULE</code>。</td>
</tr>
<tr>
<td align="left">LOCAL_MODULE_PATH</td>
<td>指示构建系统将模块放在除其类型之外的其他位置。如果覆盖它，请确保您还设置 <code>LOCAL_UNSTRIPPED_PATH</code>它是可执行文件还是共享库，以便未提取的二进制文件可以去哪里。如果忘记，将会发生错误。有关更多信息，请参阅<a href="http://android.mk/#moving-modules" target="_blank" rel="noopener">将模块置于其</a></td>
</tr>
<tr>
<td align="left">LOCAL_MODULE_STEM</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_MODULE_TAGS</td>
<td>设置<code>LOCAL_MODULE_TAGS</code>为任意数量的以空格分隔的标记。此变量控制包所包含的构造风格。例如：<code>user</code>：在user / userdebug构建中包含此内容<code>eng</code>：在eng版本中包含此内容<code>tests</code>：目标是测试目标并使其可用于测试<code>optional</code>：不包括这个</td>
</tr>
<tr>
<td align="left">LOCAL_NO_DEFAULT_COMPILER_FLAGS</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_NO_EMMA_COMPILE</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_NO_EMMA_INSTRUMENT</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_NO_STANDARD_LIBRARIES</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_OVERRIDES_PACKAGES</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_PACKAGE_NAME</td>
<td><code>LOCAL_PACKAGE_NAME</code>是应用程序的名称。例如，拨号器，联系人等</td>
</tr>
<tr>
<td align="left">LOCAL_POST_PROCESS_COMMAND</td>
<td>对于主机可执行文件，您可以指定在链接后在模块上运行的命令。由于早期或晚期变量评估，您可能必须经历一些扭曲以获得正确的变量：<code>module := $(HOST_OUT_EXECUTABLES)/$(LOCAL_MODULE)LOCAL_POST_PROCESS_COMMAND := /Developer/Tools/Rez -d __DARWIN__ -t APPL\       -d __WXMAC__ -o $(module) Carbon.r</code></td>
</tr>
<tr>
<td align="left">LOCAL_PREBUILT_EXECUTABLES</td>
<td>包含$（BUILD_PREBUILT）或$（BUILD_HOST_PREBUILT）时，请将这些设置为要复制的可执行文件。它们自动位于正确的bin目录中。</td>
</tr>
<tr>
<td align="left">LOCAL_PREBUILT_JAVA_LIBRARIES</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_PREBUILT_LIBS</td>
<td>包含$（BUILD_PREBUILT）或$（BUILD_HOST_PREBUILT）时，请将这些设置为要复制的库。它们自动位于右侧lib目录中。</td>
</tr>
<tr>
<td align="left">LOCAL_PREBUILT_OBJ_FILES</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_PREBUILT_STATIC_JAVA_LIBRARIES</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_PRELINK_MODULE</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_REQUIRED_MODULES</td>
<td>设置<code>LOCAL_REQUIRED_MODULES</code>为任意数量的以空格分隔的模块名称，例如“libblah”或“Email”。如果安装了此模块，则还将安装所需的所有模块。这可用于例如确保在安装给定应用程序时安装必要的共享库或提供程序。</td>
</tr>
<tr>
<td align="left">LOCAL_RESOURCE_DIR</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_SDK_VERSION</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_SHARED_LIBRARIES</td>
<td>这些是您直接链接的库。您不需要传递包含传递的库。指定不带后缀的名称：<code>LOCAL_SHARED_LIBRARIES := \    libutils \    libui \    libaudio \    libexpat \    libsgl</code></td>
</tr>
<tr>
<td align="left">LOCAL_SRC_FILES</td>
<td>构建系统会查看<code>LOCAL_SRC_FILES</code>要编译的源文件 - .cpp .c .y .l .java。对于lex和yacc文件，它知道如何自动正确执行中间.h和.c / .cpp文件。如果文件位于包含Android.mk的文件的子目录中，请在其前面加上目录名称：<code>LOCAL_SRC_FILES := \    file1.cpp \    dir/file2.cpp</code></td>
</tr>
<tr>
<td align="left">LOCAL_STATIC_JAVA_LIBRARIES</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_STATIC_LIBRARIES</td>
<td>这些是要包含在模块中的静态库。大多数情况下，我们使用共享库，但有几个地方，比如sbin和主机可执行文件中的可执行文件，我们使用静态库代替。<code>LOCAL_STATIC_LIBRARIES := \    libutils \    libtinyxml</code></td>
</tr>
<tr>
<td align="left">LOCAL_UNINSTALLABLE_MODULE</td>
<td></td>
</tr>
<tr>
<td align="left">LOCAL_UNSTRIPPED_PATH</td>
<td>指示构建系统将模块的未剥离版本放在除了其类型的正常之外的某个位置。通常，您重写此操作是因为您<code>LOCAL_MODULE_PATH</code>为可执行文件或共享库进行了覆盖。如果您覆盖<code>LOCAL_MODULE_PATH</code>但不是 <code>LOCAL_UNSTRIPPED_PATH</code>，则会发生错误。有关更多信息，请参阅<a href="http://android.mk/#moving-modules" target="_blank" rel="noopener">将模块置于其</a></td>
</tr>
<tr>
<td align="left">LOCAL_WHOLE_STATIC_LIBRARIES</td>
<td>这些是您希望包含在模块中的静态库，而不允许链接器从中删除死代码。如果要将静态库添加到共享库并从共享库中公开静态库的内容，这将非常有用。<code>LOCAL_WHOLE_STATIC_LIBRARIES := \    libsqlite3_android</code></td>
</tr>
<tr>
<td align="left">LOCAL_YACCFLAGS</td>
<td>要传递给模块的yacc调用的任何标志。这里的一个已知限制是，对于模块的所有YACC调用，标志都是相同的。这可以修复。如果您需要它，请问。<code>LOCAL_YACCFLAGS := -p kjsyy</code></td>
</tr>
<tr>
<td align="left">OVERRIDE_BUILT_MODULE_PATH</td>
<td></td>
</tr>
</tbody></table>
<h1 id="Makefile模板"><a href="#Makefile模板" class="headerlink" title="Makefile模板"></a>Makefile模板</h1><h2 id="文件目录结构："><a href="#文件目录结构：" class="headerlink" title="文件目录结构："></a>文件目录结构：</h2><figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">- dynamiclibapp.c</span><br><span class="line">- Makefile</span><br><span class="line">- comm/inc/apue.h</span><br><span class="line">- comm/errorhandle.c</span><br><span class="line">- dynamiclib/Makefile</span><br><span class="line">- dynamiclib/dynamiclib_add.c</span><br><span class="line">- dynamiclib/dynamiclib_mul.c</span><br><span class="line">- dynamiclib/inc/dynamiclibs.h</span><br><span class="line">- dynamiclib/libs/</span><br></pre></td></tr></tbody></table></figure>
<h2 id="dynamiclib目录"><a href="#dynamiclib目录" class="headerlink" title="dynamiclib目录"></a>dynamiclib目录</h2><ul>
<li>dynamiclib/inc/dynamiclibs.h （对两个c文件中函数的声明）  </li>
</ul>
<p>文件内容如下:</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">1</span> <span class="meta">#<span class="meta-keyword">ifndef</span> __dynamic_libs_h__</span></span><br><span class="line"><span class="number">2</span> <span class="meta">#<span class="meta-keyword">define</span> __dynamic_libs_h__</span></span><br><span class="line"><span class="number">3</span> </span><br><span class="line"><span class="number">4</span> <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"apue.h"</span></span></span><br><span class="line"><span class="number">5</span> <span class="function"><span class="keyword">int</span> <span class="title">dynamic_lib_func_add</span><span class="params">(<span class="keyword">int</span> i1, <span class="keyword">int</span> i2)</span></span>;</span><br><span class="line"><span class="number">6</span> <span class="function"><span class="keyword">int</span> <span class="title">dynamic_lib_func_mul</span><span class="params">(<span class="keyword">int</span> i1, <span class="keyword">int</span> i2)</span></span>;</span><br><span class="line"><span class="number">7</span> </span><br><span class="line"><span class="number">8</span> <span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>dynamiclib/dynamiclib_add.c 文件内容如下:</li>
</ul>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">1</span> <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"dynamiclibs.h"</span></span></span><br><span class="line"><span class="number">2</span> </span><br><span class="line"><span class="number">3</span> <span class="function"><span class="keyword">int</span> <span class="title">dynamic_lib_func_add</span><span class="params">(<span class="keyword">int</span> i1, <span class="keyword">int</span> i2)</span> </span></span><br><span class="line"><span class="function">4 </span>{</span><br><span class="line"><span class="number">5</span>     <span class="keyword">int</span> iret = i1 + i2; </span><br><span class="line"><span class="number">6</span>     <span class="built_in">printf</span>(<span class="string">"... in .so func, %d add %d,return %d\n"</span>, i1, i2, iret);</span><br><span class="line"><span class="number">7</span>     <span class="keyword">return</span> iret;</span><br><span class="line"><span class="number">8</span> }</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>dynamiclib/dynamiclib_mul.c 文件内容如下:</li>
</ul>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">1</span> <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"dynamiclibs.h"</span></span></span><br><span class="line"><span class="number">2</span> </span><br><span class="line"><span class="number">3</span> <span class="function"><span class="keyword">int</span> <span class="title">dynamic_lib_func_mul</span><span class="params">(<span class="keyword">int</span> i1, <span class="keyword">int</span> i2)</span> </span></span><br><span class="line"><span class="function">4 </span>{</span><br><span class="line"><span class="number">5</span>     <span class="keyword">int</span> iret = i1 * i2; </span><br><span class="line"><span class="number">6</span>     <span class="built_in">printf</span>(<span class="string">"... in .so func, %d multiplys %d, retun %d\n"</span>, i1, i2, iret);</span><br><span class="line"><span class="number">7</span>     <span class="keyword">return</span> iret;</span><br><span class="line"><span class="number">8</span> }</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>dynamiclib/Makefile 文件内容如下:</li>
</ul>
<figure class="highlight makefile"><table><tbody><tr><td class="code"><pre><span class="line"> 1 CC       = gcc </span><br><span class="line"> 2 CFLAGS   = -Wall -g -O -fPIC     </span><br><span class="line">   <span class="comment"># 需要加上 -fPIC</span></span><br><span class="line">   <span class="comment"># 为了兼容各个系统，在生成位置无关的代码的时候，应该使用-fPIC参数。</span></span><br><span class="line"> 3 CXXFLAGS = </span><br><span class="line"> 4 INCLUDE  = -I ./inc -I ../comm/inc</span><br><span class="line"> 5 TARGET   = libmytest.so</span><br><span class="line"> 6 LIBPATH  = ./libs/</span><br><span class="line"> 7 </span><br><span class="line"> 8 <span class="keyword">vpath</span> %.h ./inc</span><br><span class="line"> 9 </span><br><span class="line">10 OBJS     = dynamiclib_add.o dynamiclib_mul.o</span><br><span class="line">11 SRCS     = dynamiclib_add.c dynamiclib_mul.c</span><br><span class="line">12 </span><br><span class="line">13 <span class="variable">$(OBJS)</span>:<span class="variable">$(SRCS)</span></span><br><span class="line">14    <span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> <span class="variable">$(INCLUDE)</span> -c <span class="variable">$^</span></span><br><span class="line">15 </span><br><span class="line">16 all:<span class="variable">$(OBJS)</span></span><br><span class="line">17    <span class="variable">$(CC)</span> -shared -fPIC -o <span class="variable">$(TARGET)</span> <span class="variable">$(OBJS)</span>    需要加上 -shared -fPIC</span><br><span class="line">18    mv <span class="variable">$(TARGET)</span> <span class="variable">$(LIBPATH)</span></span><br><span class="line">19 </span><br><span class="line">20 clean:</span><br><span class="line">21    rm -f *.o</span><br><span class="line">22    rm -f <span class="variable">$(LIBPATH)</span>*</span><br></pre></td></tr></tbody></table></figure>
<h2 id="加载"><a href="#加载" class="headerlink" title="加载"></a>加载</h2><p>以上文件，就可以生成动态库文件 libmytest.so，应用程序以两种方式加载动态库函数，如下</p>
<h4 id="在编译应用程序时加载动态库"><a href="#在编译应用程序时加载动态库" class="headerlink" title="在编译应用程序时加载动态库"></a>在编译应用程序时加载动态库</h4><p>dynamiclibapp.c 文件内容如下</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"> <span class="number">1</span> <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"apue.h"</span></span></span><br><span class="line"> <span class="number">2</span> <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"dynamiclibs.h"</span></span></span><br><span class="line"> <span class="number">3</span> </span><br><span class="line"> <span class="number">4</span> <span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"> 5 </span>{</span><br><span class="line"> <span class="number">6</span>     err_msg(<span class="string">"step in main\n"</span>);</span><br><span class="line"> <span class="number">7</span>     dynamic_lib_func_add(<span class="number">1</span>, <span class="number">9</span>); </span><br><span class="line"> <span class="number">8</span>     dynamic_lib_func_mul(<span class="number">1</span>, <span class="number">9</span>); </span><br><span class="line"> <span class="number">9</span>     err_msg(<span class="string">"step out main\n"</span>);</span><br><span class="line"><span class="number">10</span> </span><br><span class="line"><span class="number">11</span>     <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="number">12</span> }</span><br></pre></td></tr></tbody></table></figure>
<p>Makefile 文件内容如下：</p>
<figure class="highlight makefile"><table><tbody><tr><td class="code"><pre><span class="line"> 1 CC       = gcc </span><br><span class="line"> 2 CFLAGS   = -Wall -O -g</span><br><span class="line"> 3 CXXFLAGS = </span><br><span class="line"> 4 INCLUDE  = -I ./comm/inc -I ./dynamiclib/inc</span><br><span class="line"> 5 TARGET   = dynamiclibapp</span><br><span class="line"> 6 LIBVAR   = -lmytest             指明需要链接动态库 libmytest.so</span><br><span class="line"> 7 LIBPATH  = -L./dynamiclib/libs  指明 libmytest.so 的路径</span><br><span class="line"> 8 <span class="comment">#search paths for errorhandler.c</span></span><br><span class="line"> 9 <span class="keyword">vpath</span> %.c ./comm</span><br><span class="line">10 <span class="comment">#下行是为依赖项 apue.h 准备的，比如 [errorhandler.o:errorhandler.c apue.h] 里的 apue.h</span></span><br><span class="line">11 <span class="keyword">vpath</span> %.h ./comm/inc</span><br><span class="line">12 </span><br><span class="line">13 OBJS     = errorhandler.o dynamiclibapp.o</span><br><span class="line">14 <span class="comment">#下行的 apue.h，可以不必写出来</span></span><br><span class="line">15 errorhandler.o:errorhandler.c apue.h</span><br><span class="line">16    <span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> <span class="variable">$(INCLUDE)</span> -c <span class="variable">$^</span></span><br><span class="line">17 dynamiclibapp.o:dynamiclibapp.c apue.h</span><br><span class="line">18    <span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> <span class="variable">$(INCLUDE)</span> -c <span class="variable">$^</span></span><br><span class="line">19 </span><br><span class="line">20 all:<span class="variable">$(OBJS)</span> <span class="variable">$(LIB)</span></span><br><span class="line">21    cd ./dynamiclib && make all</span><br><span class="line">22    <span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> <span class="variable">$(INCLUDE)</span> -o <span class="variable">$(TARGET)</span> <span class="variable">$(OBJS)</span> <span class="variable">$(LIBPATH)</span> <span class="variable">$(LIBVAR)</span></span><br><span class="line">23    在上行中，在执行编译时，加载了 libmytest.so 中函数</span><br><span class="line">24 clean:</span><br><span class="line">25    rm -f *.o</span><br><span class="line">26    rm -f comm/inc/*.gch</span><br><span class="line">27    rm -f <span class="variable">$(TARGET)</span></span><br><span class="line">28    cd ./dynamiclib && make clean</span><br></pre></td></tr></tbody></table></figure>
<p>对于这种方式编译出来的动态库文件，还需要在 /etc/ld.so.conf.d/ 目录中添加 libmytest.so 库文件的路径说明，即在 /etc/ld.so.conf.d/ 目录中新建配置文件 mytest.conf，且执行 ldconfig， /etc/ld.so.conf.d/mytest.conf 的文件内容为 libmytest.so 库文件的绝对路径，例如：1 /home/lijiangtao/dynamiclib/libs<br>如果不在编译应用程序时加载动态库文件里的函数，而是改为在应用程序执行时(比如：程序的main函数启动期间，或在程序执行期间)加载 libmytest.so 里函数，那么就可以不需在 /etc/ld.so.conf.d/ 目录中配置 libmytest.so路径，具体如下所述。</p>
<h4 id="在应用程序执行时加载动态库"><a href="#在应用程序执行时加载动态库" class="headerlink" title="在应用程序执行时加载动态库"></a>在应用程序执行时加载动态库</h4><p>dynamiclibapp.c 文件内容如下：</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="number">1</span> <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"apue.h"</span></span></span><br><span class="line"> <span class="number">2</span> <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"dynamiclibs.h"</span></span></span><br><span class="line"> <span class="number">3</span> <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string"><dlfcn.h></span></span></span><br><span class="line"> <span class="number">4</span> </span><br><span class="line"> <span class="number">5</span> <span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*fp_lib_add)</span><span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"> <span class="number">6</span> <span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*fp_lib_mul)</span><span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"> <span class="number">7</span> <span class="keyword">typedef</span> <span class="keyword">void</span>* dlhandle;</span><br><span class="line"> <span class="number">8</span> </span><br><span class="line"> <span class="number">9</span> dlhandle      dll      = <span class="literal">NULL</span>;</span><br><span class="line"><span class="number">10</span> fp_lib_add    func_add = <span class="literal">NULL</span>;</span><br><span class="line"><span class="number">11</span> fp_lib_mul    func_mul = <span class="literal">NULL</span>;</span><br><span class="line"><span class="number">12</span> </span><br><span class="line"><span class="number">13</span> <span class="function">dlhandle <span class="title">load_dynamic_func</span><span class="params">(<span class="keyword">char</span> *psopath, fp_lib_add *padd, fp_lib_mul *pmul)</span></span>;</span><br><span class="line"><span class="number">14</span> </span><br><span class="line"><span class="number">15</span> <span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function">16 </span>{</span><br><span class="line"><span class="number">17</span>     <span class="keyword">char</span> *pso = <span class="string">"/home/lijiangtao/dynamiclib/libs/libmytest.so"</span>;<span class="comment">//指定 .so 路径</span></span><br><span class="line"><span class="number">18</span>     dll = load_dynamic_func(pso, &func_add, &func_mul);<span class="comment">//程序执行时，加载动态函数</span></span><br><span class="line"><span class="number">19</span>     err_msg(<span class="string">"step in main\n"</span>);</span><br><span class="line"><span class="number">20</span>     func_add(<span class="number">1</span>, <span class="number">9</span>);<span class="comment">//执行 add 函数</span></span><br><span class="line"><span class="number">21</span>     func_mul(<span class="number">1</span>, <span class="number">9</span>);<span class="comment">//执行 mul 函数</span></span><br><span class="line"><span class="number">22</span>     err_msg(<span class="string">"step out main\n"</span>);</span><br><span class="line"><span class="number">23</span> </span><br><span class="line"><span class="number">24</span>     <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="number">25</span> }</span><br><span class="line"><span class="number">26</span> </span><br><span class="line"><span class="number">27</span> <span class="function">dlhandle <span class="title">load_dynamic_func</span><span class="params">(<span class="keyword">char</span> *psopath, fp_lib_add *padd, fp_lib_mul *pmul)</span></span></span><br><span class="line"><span class="function">28 </span>{</span><br><span class="line"><span class="number">29</span>     <span class="keyword">if</span>(<span class="literal">NULL</span> == psopath ||<span class="string">'\0'</span> == psopath[<span class="number">0</span>])</span><br><span class="line"><span class="number">30</span>         <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="number">31</span>     <span class="keyword">char</span> *perrormsg = <span class="literal">NULL</span>;</span><br><span class="line"><span class="number">32</span>     dlhandle dllhandle = dlopen(psopath, RTLD_LAZY);</span><br><span class="line"><span class="number">33</span>     <span class="keyword">if</span>(<span class="literal">NULL</span> == dllhandle) </span><br><span class="line"><span class="number">34</span>     {   </span><br><span class="line"><span class="number">35</span>         <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, dlerror());</span><br><span class="line"><span class="number">36</span>         <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="number">37</span>     } </span><br><span class="line"><span class="number">38</span>     <span class="keyword">if</span>(<span class="literal">NULL</span> != padd)</span><br><span class="line"><span class="number">39</span>     {</span><br><span class="line"><span class="number">40</span>         *padd = dlsym(dllhandle, <span class="string">"dynamic_lib_func_add"</span>);<span class="comment">//加载 add 函数</span></span><br><span class="line"><span class="number">41</span>         perrormsg = dlerror();</span><br><span class="line"><span class="number">42</span>         <span class="keyword">if</span>(<span class="literal">NULL</span> != perrormsg)</span><br><span class="line"><span class="number">43</span>             <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, perrormsg);</span><br><span class="line"><span class="number">44</span>     }</span><br><span class="line"><span class="number">45</span>     <span class="keyword">if</span>(<span class="literal">NULL</span> != pmul)</span><br><span class="line"><span class="number">46</span>     {</span><br><span class="line"><span class="number">47</span>         *pmul = dlsym(dllhandle, <span class="string">"dynamic_lib_func_mul"</span>);<span class="comment">//加载 mul 函数</span></span><br><span class="line"><span class="number">48</span>         perrormsg = dlerror();</span><br><span class="line"><span class="number">49</span>         <span class="keyword">if</span>(<span class="literal">NULL</span> != perrormsg)</span><br><span class="line"><span class="number">50</span>             <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, perrormsg);</span><br><span class="line"><span class="number">51</span>     }</span><br><span class="line"><span class="number">52</span>     <span class="keyword">return</span> dllhandle;</span><br><span class="line"><span class="number">53</span> }</span><br></pre></td></tr></tbody></table></figure>

<h3 id="c-c-混合编译"><a href="#c-c-混合编译" class="headerlink" title="c/c++ 混合编译"></a>c/c++ 混合编译</h3><p>c用gcc编译，c++用g++编译，分别生成.o文件，最后变成最终的库</p>
<figure class="highlight plain"><table><tbody><tr><td class="code"><pre><span class="line">CC = arm-poky-linux-gnueabi-gcc</span><br><span class="line">C++ = arm-poky-linux-gnueabi-g++</span><br><span class="line">LINK = arm-poky-linux-gnueabi-g++</span><br><span class="line"> </span><br><span class="line">LIBS = -lz -lm -lpcre -lpthread</span><br><span class="line">#编译.so must add -fPIC option  https://www.cnblogs.com/cswuyg/p/3830703.html</span><br><span class="line">CCFLAGS = -c -g -fPIC</span><br><span class="line">C++FLAGS = -c -g -fPIC</span><br><span class="line"></span><br><span class="line">#期望得到的执行文件或动态库.so</span><br><span class="line">TARGET=libxx.so</span><br><span class="line"> </span><br><span class="line">INCLUDES = -I. -I../../</span><br><span class="line"> </span><br><span class="line">C++FILES = $(wildcard *.cpp ./../common/*.cpp)</span><br><span class="line">CFILES = $(wildcard *.c ./../common/*.c)</span><br><span class="line"> </span><br><span class="line">OBJFILE = $(CFILES:.c=.o) $(C++FILES:.cpp=.o)</span><br><span class="line"> </span><br><span class="line">all:$(TARGET)</span><br><span class="line"> </span><br><span class="line">$(TARGET): $(OBJFILE)</span><br><span class="line">	$(LINK) $^ $(LIBS) -Wall -fPIC -shared -o $@</span><br><span class="line"> </span><br><span class="line">%.o:%.c</span><br><span class="line">	$(CC) -o $@ $(CCFLAGS) $< $(INCLUDES)</span><br><span class="line"> </span><br><span class="line">%.o:%.cpp</span><br><span class="line">	$(C++) -o $@ $(C++FLAGS) $< $(INCLUDES)</span><br><span class="line"> </span><br><span class="line">install:</span><br><span class="line">	tsxs -i -o $(TARGET)</span><br><span class="line"> </span><br><span class="line">clean:</span><br><span class="line">	rm -rf $(TARGET)</span><br><span class="line">    rm -rf $(OBJFILE)</span><br></pre></td></tr></tbody></table></figure>

<p>需要注意的是为了能够让C++调用C语言代码，需要在头文件加上extern “C”，代码如下：</p>
<figure class="highlight c"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus <span class="comment">//而这一部分就是告诉编译器，如果定义了__cplusplus(即如果是cpp文件， </span></span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span>{ <span class="comment">//因为cpp文件默认定义了该宏),则采用C语言方式进行编译</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> </span></span><br><span class="line">...</span><br><span class="line">    </span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line">}</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></tbody></table></figure></body></html></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">xiaoqinxing</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.qinxing.xyz/posts/21c9d9a6/">https://www.qinxing.xyz/posts/21c9d9a6/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.qinxing.xyz" target="_blank">清新的日子</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/c-c/">c/c++</a><a class="post-meta__tags" href="/tags/Makefile/">Makefile</a></div><div class="post_share"><div class="social-share" data-image="https://image.qinxing.xyz/20200317000739.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付寶"/></a><div class="post-qr-code-desc">支付寶</div></li></ul></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/6cbd822f/"><img class="prev-cover" src="https://image.qinxing.xyz/20200317000511.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">sensor模块代码理解及学习</div></div></a></div><div class="next-post pull-right"><a href="/posts/7bbb0585/"><img class="next-cover" src="https://image.qinxing.xyz/20200317001538.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">BUG：AE打印延迟</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/83169df8/" title="cmake 指南"><img class="cover" src="https://image.qinxing.xyz/20201010104927.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-27</div><div class="title">cmake 指南</div></div></a></div><div><a href="/posts/64e59afd/" title="c++ 强制类型转换"><img class="cover" src="https://image.qinxing.xyz/20200609195436.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-05-29</div><div class="title">c++ 强制类型转换</div></div></a></div><div><a href="/posts/356a46c3/" title="BUG：两路摄像头自动日夜切换问题"><img class="cover" src="https://image.qinxing.xyz/20200316233007.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-03-22</div><div class="title">BUG：两路摄像头自动日夜切换问题</div></div></a></div><div><a href="/posts/9c00316/" title="编译版本信息打印功能实现"><img class="cover" src="https://image.qinxing.xyz/20200322232613.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-03-20</div><div class="title">编译版本信息打印功能实现</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></article></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2021 By xiaoqinxing</div><div class="footer_custom_text"><a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target="_blank" rel="nofollow"><img src="/img/又拍云_logo6.png" alt="CDN赞助商" style="max-height:2em"></a></div><div class="icp"><a href="http://www.beian.miit.gov.cn/" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"/><span>苏ICP备20006733号</span></a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    $.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js', function () {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script><script>function loadValine () {
  function initValine () {
    const initData = {
      el: '#vcomment',
      appId: '2pB7a7KQi6qQhvy3lVryrecn-gzGzoHsz',
      appKey: 'CGbafSzCCsV7hW2NbXXSEjRM',
      placeholder: '快来留言吧~\r\n昵称里面填qq号，可以自动出现昵称和邮箱~',
      avatar: 'wavatar',
      meta: 'nick,mail'.split(','),
      pageSize: '10',
      lang: 'zh-cn',
      recordIP: false,
      serverURLs: 'https://valine.qinxing.xyz',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }

    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script>(function(){
  const bp = document.createElement('script');
  const curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https'){
  bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  bp.dataset.pjax = ''
  const s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})()</script></div></body></html>