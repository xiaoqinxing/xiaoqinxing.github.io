<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>CHI模块指南 | 清新的日子</title><meta name="keywords" content="编程,高通,camx"><meta name="author" content="xiaoqinxing"><meta name="copyright" content="xiaoqinxing"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="对高通CAMX架构中的CHI知识点进行整理如何通过xml配置拓扑图CHI架构的大致流程是什么样的？">
<meta property="og:type" content="article">
<meta property="og:title" content="CHI模块指南">
<meta property="og:url" content="https://www.qinxing.xyz/posts/8b80089f/index.html">
<meta property="og:site_name" content="清新的日子">
<meta property="og:description" content="对高通CAMX架构中的CHI知识点进行整理如何通过xml配置拓扑图CHI架构的大致流程是什么样的？">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://image.qinxing.xyz/20200513145157.png">
<meta property="article:published_time" content="2020-05-11T16:00:00.000Z">
<meta property="article:modified_time" content="2021-03-09T15:46:14.275Z">
<meta property="article:author" content="xiaoqinxing">
<meta property="article:tag" content="编程">
<meta property="article:tag" content="高通">
<meta property="article:tag" content="camx">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://image.qinxing.xyz/20200513145157.png"><link rel="shortcut icon" href="/img/pwaicons/favicon.ico"><link rel="canonical" href="https://www.qinxing.xyz/posts/8b80089f/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//pingjs.qq.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="preconnect" href="//zz.bdstatic.com"/><meta name="google-site-verification" content="Osf5KuSN_EP3Uk2LaoVo568hFQb2-0VdKOOoJnxTC5g"/><link rel="manifest" href="/manifest.json"/><meta name="msapplication-TileColor" content="#fff"/><link rel="apple-touch-icon" sizes="180x180" href="/img/pwaicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/img/pwaicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/img/pwaicons/favicon-16x16.png"/><link rel="mask-icon" href="/img/pwaicons/safari-pinned-tab.svg" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?b21df310b77ed0cbce2ac9993f8a13f5";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>var _mtac = {};
(function() {
    var mta = document.createElement("script");
    mta.src = "//pingjs.qq.com/h5/stats.js?v2.0.4";
    mta.setAttribute("name", "MTAH5");
    mta.setAttribute("sid", "66531382");
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(mta, s);
})();
</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '4.2.0',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":100,"languages":{"author":"作者: xiaoqinxing","link":"链接: ","source":"来源: 清新的日子","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2021-03-09 23:46:14'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
  }
}

var autoChangeMode = 'false'
var t = saveToLocal.get('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (saveToLocal.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://image.qinxing.xyz/dac12727b0ba786043e8cdefd90f1c35_1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">103</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">113</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">23</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa fa-comment"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 收藏</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fa fa-book"></i><span> 书籍</span></a></li><li><a class="site-page" href="/website/"><i class="fa-fw fa fa-tag"></i><span> 网站</span></a></li></ul></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#（一）简介"><span class="toc-number">1.</span> <span class="toc-text">（一）简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#为什么要用CHI模块？"><span class="toc-number">1.1.</span> <span class="toc-text">为什么要用CHI模块？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#什么时候要用到CHI模块？"><span class="toc-number">1.2.</span> <span class="toc-text">什么时候要用到CHI模块？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CHI模块是什么？"><span class="toc-number">1.3.</span> <span class="toc-text">CHI模块是什么？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CHI的五个关键自定义组件"><span class="toc-number">1.4.</span> <span class="toc-text">CHI的五个关键自定义组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#重要术语"><span class="toc-number">1.5.</span> <span class="toc-text">重要术语</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#（二）CHI-拓扑图的XML配置"><span class="toc-number">2.</span> <span class="toc-text">（二）CHI 拓扑图的XML配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#基本概念"><span class="toc-number">2.1.</span> <span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XML的组成"><span class="toc-number">2.2.</span> <span class="toc-text">XML的组成</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#（三）CHI-架构模型"><span class="toc-number">3.</span> <span class="toc-text">（三）CHI 架构模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#overview"><span class="toc-number">3.1.</span> <span class="toc-text">overview</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#流程"><span class="toc-number">3.2.</span> <span class="toc-text">流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#元数据metadata"><span class="toc-number">3.3.</span> <span class="toc-text">元数据metadata</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#（四）代码细节"><span class="toc-number">4.</span> <span class="toc-text">（四）代码细节</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-加载外部二进制库"><span class="toc-number">4.1.</span> <span class="toc-text">1. 加载外部二进制库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-CHI-接口"><span class="toc-number">4.2.</span> <span class="toc-text">2. CHI 接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-HAL3到CHI-重写接口（override）"><span class="toc-number">4.3.</span> <span class="toc-text">3. HAL3到CHI 重写接口（override）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-CHI-节点接口"><span class="toc-number">4.4.</span> <span class="toc-text">4. CHI 节点接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-CHI-stats-重写"><span class="toc-number">4.5.</span> <span class="toc-text">5. CHI stats 重写</span></a></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://image.qinxing.xyz/20200513145157.png)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">清新的日子</a></span><span id="menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fa fa-comment"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 收藏</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fa fa-book"></i><span> 书籍</span></a></li><li><a class="site-page" href="/website/"><i class="fa-fw fa fa-tag"></i><span> 网站</span></a></li></ul></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">CHI模块指南</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-05-11T16:00:00.000Z" title="发表于 2020-05-12 00:00:00">2020-05-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-03-09T15:46:14.275Z" title="更新于 2021-03-09 23:46:14">2021-03-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%B7%A5%E4%BD%9C/">工作</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%B7%A5%E4%BD%9C/%E7%BC%96%E7%A8%8B/">编程</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>14分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><html><head></head><body><h2 id="（一）简介"><a href="#（一）简介" class="headerlink" title="（一）简介"></a>（一）简介</h2><h3 id="为什么要用CHI模块？"><a href="#为什么要用CHI模块？" class="headerlink" title="为什么要用CHI模块？"></a>为什么要用CHI模块？</h3><p>android开发了相机硬件接口，使OEM可以为用户生产高质量的相机解决方案，camera2 API和HAL3接口的结合提供了足够的灵活性，可以支持大多数的使用案例。</p>
<p>但是当java层负责控制执行流程是，在其他引擎（GPU,CPU,DSP)上的延迟或潜在的低效率处理可能是不可接受的，OEM可以通过绕过HAL3接口并直接修改摄像头驱动程序来更有效的实现自定义的功能。</p>
<p>CHI API是建立在HAL3接口的基础上，HAL3是谷歌围绕camera pipeline精确的每个请求设计的，为了给用户提供一个完整的图像处理控制，但是这个请求是有限的。而CHI旨在提供更加精细的控制，以及可以访问ISP中的处理引擎。这个接口可以让照相和通用的图像处理APP提供低延时的软硬件处理。</p>
<h3 id="什么时候要用到CHI模块？"><a href="#什么时候要用到CHI模块？" class="headerlink" title="什么时候要用到CHI模块？"></a>什么时候要用到CHI模块？</h3><p>当camera2/HAL3 接口有如下限制的时候：</p>
<ol>
<li>没有接口可以访问ISP里面各个固定功能的引擎，ISP不是固定一块的，是由各个硬件和软件模块组成的，我利用CHI可以调用ISP里面的单独的一个模块</li>
<li>没有接口可以精确地请求一个处理流程，利用CHI可以控制图像处理的每个节点，从而控制图像的每个处理流程</li>
<li>用例的定义比较松散，预期的处理可能和想像中不同</li>
<li>管道深度是基于预期的用例调试的，为了实现一个复杂的处理流程，对于大多数的HAL3相机驱动来说，特别的请求数量太多了。</li>
<li>需要最少的处理和最小的延迟</li>
</ol>
<h3 id="CHI模块是什么？"><a href="#CHI模块是什么？" class="headerlink" title="CHI模块是什么？"></a>CHI模块是什么？</h3><p>CHI 是为了分离Camera2/HAL3接口，并提供一个完整灵活的图像处理驱动。它可以作为独立的实体进行访问。它能够使用来自sensor或者内存的图像数据（这个惊呆了，不仅仅可以处理来自camera数据，也可以处理来自应用的数据）。</p>
<p>为了让高通的spectra能够和现有的camera2/HAL3接口保持向后兼容，将HAL3驱动转换成了恰当的CHI调用。也就是说HAL3的所有实现，都是通过调用CHI接口实现的。（这一点是和老平台的mm-camera是一样的吧）</p>
<p>CHI提供了一个overrides的接口，允许OEM修改高通默认的camera用例实现（HAL3的实现），不仅仅可以正常的使用Camera2/HAL3的应用程序，同时还可以同时获得CHI提供的灵活性。这些代替的操作(overrides)可以让OEM在任何可获得的引擎上实现各种各样的图像处理，具有低延时，不需要在多个引擎之间协调同步的特点。</p>
<h3 id="CHI的五个关键自定义组件"><a href="#CHI的五个关键自定义组件" class="headerlink" title="CHI的五个关键自定义组件"></a>CHI的五个关键自定义组件</h3><ol>
<li><strong>CHI override</strong>：可以对HAL3接口进行补充，为任何一个兼容HAL3的APP提供精细的图像处理流程，精确的引擎选择，以及多帧图像的控制。</li>
<li><strong>CHI pipeline</strong> ：可以自定义ISP pipeline来处理图像，pipeline由固定功能的ISP功能块（FF-ISP)和拓展的节点（node)组成，这部分可以由xml文件进行配置。当然了直接调用CHI也可以以编程的方式生成pipeline（不过谁会这么傻呢）。</li>
<li><strong>CHI node extensions</strong>：它是图像的处理节点，可以进行扩展，提供了方便的hooks来简化CPU，GPU(openCL, openGL ES或Vulkan)或者DSP(OpenDSP,，Qualcomm® Computer Vision SDK, 或自定义编程)</li>
<li><strong>CHI stats overrides</strong>：允许重写高通默认的统计算法（包括3A），而无需更改驱动程序。外部统计算法可以存储私有的数据，自定义的节点也可以访问这些数据。</li>
<li><strong>CHI sensor XML</strong>：通过xml配置不同的硬件，包括图像传感器，马达，EEPROM，闪光灯等组件。</li>
</ol>
<h3 id="重要术语"><a href="#重要术语" class="headerlink" title="重要术语"></a>重要术语</h3><ol>
<li><p><strong>Use case</strong>：用例，是camera pipeline的特定配置，为某个特定的场景使用。比如说2K的预览的同时可以20MP的抓拍，这就是一个use case。同一个用例可以有多条camera pipeline。在底层硬件的限制类指定任何可能的用例，上层不需要修改驱动程序就可以适应各种场景。</p>
</li>
<li><p><strong>topology</strong>：拓扑图，由一系列处理节点和一组链接组成。</p>
</li>
<li><p><strong>Engine</strong>：引擎，可用于处理数据的硬件。 如Spectra ISP，Snapdragon CPU，Adreno和DSP。</p>
</li>
<li><p><strong>Node</strong>：节点，是camera pipeline的逻辑功能块，运行在单个引擎上。节点连起来就是拓扑图。</p>
</li>
<li><p><strong>Pipeline</strong>：管道， 包含了一个拓扑图。驱动程序利用pipeline来了解说用到的引擎，以及输出处理的流程。</p>
</li>
<li><p><strong>session</strong>：会话，具有1-n个管道。会话管理所有的硬件资源，以及连接到它的所有管道中的未决请求。支持多个并行，每个会话在多个请求中都保持自己的状态，不受其他会话的影响。停用会话，才释放分配给它的所有资源。</p>
</li>
<li><p><strong>request</strong>：请求，触发管道处理数据的动作。 这可以是处理从图像传感器提取的数据帧或处理来自内存的数据的请求。 驱动程序必须为每个请求返回结果。HAL3和CHI请求是分开管理的。（这两个请求是不一样的）</p>
</li>
<li><p><strong>sub-request</strong>: 子请求，将单个HAL3请求分解为多个CHI请求的操作。子请求的结构不会在驱动程序(CHI)外部反馈，而是将它们合并成一个结果，该结果与原始请求像对应。子请求用于启用 Camera2功能，如HDR，请求多个不同曝光时间的图像，最终产生单个图像。再比如多帧图像后处理，将多个图像合并以创建单个图像输出。子请求是用例管理的一部分，可以在CHI override模块使用。</p>
</li>
<li><p><strong>Stream</strong>：流，具有相同大小和格式的缓冲区序列，用于处理图像数据。可以将多个不同类型的流指定为camera pipeline的输入和输出。这组流是定义Camera2 / HAL3用例的关键组件。</p>
</li>
<li><p><strong>Per-session settings</strong>：单个会话设置，在会话生存期内影响处理管道的设置。会话开始后就无法更改这些设置。例如，允许图像防抖。</p>
</li>
<li><p><strong>Per-request settings</strong>：单个请求的设置。例如，手动曝光值。</p>
</li>
<li><p><strong>Statistics</strong>： 包括3A在内的算法。这些领域特定的算法被视为CHI API的专用部分。</p>
</li>
<li><p><strong>Live or realtime stream</strong>：配置来自图像传感器的数据处理，不能够修改之前请求的数据。当处理速率跟不上sensor的输出速率，应该放到离线流中。</p>
</li>
<li><p><strong>Offline stream</strong>：处理不从图像传感器接受的数据。</p>
</li>
</ol>
<h2 id="（二）CHI-拓扑图的XML配置"><a href="#（二）CHI-拓扑图的XML配置" class="headerlink" title="（二）CHI 拓扑图的XML配置"></a>（二）CHI 拓扑图的XML配置</h2><p>硬件和软件的图像处理节点（node）产生所需的输出，这些节点之间的连接确定数据将如何流过相机子系统。 这组节点和连接称为拓扑。</p>
<p>用例由一组要处理的目标和一组会话设置定义，这些设置进一步定义了应如何处理数据。 每个用例都由拓扑图表示，拓扑图是传递到HAL3 API的信息与如何处理数据的具体定义之间的联系。</p>
<p>所有用例及其对应拓扑的列表都编码在XML文件中。 一个用例是在<strong>configure_streams</strong>的时候被选择的，基于XML的两个部分：< Targets >和< SystemwideSettings >。</p>
<p>提供了一个XSD模式，该模式定义了XML的结构（这句话没太懂）。 提供了一些工具来将XML文件打包为二进制文件，以供CHI驱动程序使用。</p>
<h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><p>节点是拓扑图中的硬件或软件处理组件。 节点的定义包括了高通默认的节点和自定义的节点。一个节点有一组输入和输出，被称作输入和输出端口。</p>
<p>输出到HAL3 图像buffer的输出端口，被称作sinkbuffer 输出端口。还有一些节点的输出端口不输出到任何图像缓冲区，用于指示节点正在使用中。这些叫SinkNoBuffer。</p>
<p>通过将一个节点的输入端口连接到另一个节点的输出端口来形成拓扑图中的DAG，或者在存在反馈环路的情况下，一个节点的输出端口可以连接到其自己的输入端口。输入端口和输出端口之间的连接称为链接（link），链接还包含有关节点之间使用的必要缓冲区的信息。</p>
<p><img src="https://image.qinxing.xyz/20200513192028.png" alt="节点，端口，链接的关系"></p>
<h3 id="XML的组成"><a href="#XML的组成" class="headerlink" title="XML的组成"></a>XML的组成</h3><ol>
<li><p>UsecaseDef是根标记，在此标记中定义了各个用例Usecase。</p>
</li>
<li><p>Usecase是用例标记，它包括了匹配用例的关键，以及拓补图。里面有UsecaseName、Targets、streamconfigmode、systemwidesetting、pipeline</p>
</li>
<li><p>Targets是流的列表，包括用例执行的格式和大小范围，此处列出的流与传递到HAL3 configure_streams API的流相对应.</p>
<p>Target是单个流或目标的描述，会将本节的各个标记值（target和systemwideSettings）与传递到configure_streams中的流配置进行比较，以找到匹配的Usecase。</p>
<ol>
<li>range，缓冲区的分辨率和configure_streams（）中缓冲区的传入分辨率必须在此范围内，以便Usecase被选择为输入流配置的匹配用例</li>
<li>systemwideSettings，单个会话的设置组，定义此用例的key，这些设置对应安卓的property。</li>
<li>TargetDirection: 流的方向，可以是输入或输出，也可以是双向</li>
<li>Formats：流的数据格式</li>
</ol>
</li>
<li><p>pipeline是这个用例的pipeline，有一组节点和链接组成。pipelineName是这个pipeline的名字。</p>
<ol>
<li><p>nodesList是节点的列表。node是单个节点，告诉驱动程序如何处理一个请求。</p>
<ol>
<li><p>NodeProperty，可选的，允许安卓的几个property属性。</p>
</li>
<li><p>NodeName，节点名字</p>
</li>
<li><p>NodeId，驱动程序通过解释nodeId以了解节点类型，自定义的节点，Id都是255，这个值与NodeProperty一起通知驱动程序，确切的自定义节点类型。</p>
</li>
<li><p>NodeInstance，节点实例</p>
</li>
<li><p>NodeInstanceId ，用于表示节点的唯一实例ID，这些id用于将节点的端口彼此连接起来</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag"><<span class="name">Node</span>></span> </span><br><span class="line">    <span class="tag"><<span class="name">NodeProperty</span>></span> </span><br><span class="line">        <span class="tag"><<span class="name">NodePropertyName</span>></span>CustomNodeLibrary<span class="tag"></<span class="name">NodePropertyName</span>></span> </span><br><span class="line">        <span class="tag"><<span class="name">NodePropertyId</span>></span>1<span class="tag"></<span class="name">NodePropertyId</span>></span> </span><br><span class="line">        <span class="tag"><<span class="name">NodePropertyDataType</span>></span>STRING<span class="tag"></<span class="name">NodePropertyDataType</span>></span> </span><br><span class="line">        <span class="tag"><<span class="name">NodePropertyValue</span>></span>com.oem.node.libname<span class="tag"></<span class="name">NodePropertyValue</span>></span>  </span><br><span class="line">    <span class="tag"></<span class="name">NodeProperty</span>></span> </span><br><span class="line">    <span class="tag"><<span class="name">NodeName</span>></span>CustomNode<span class="tag"></<span class="name">NodeName</span>></span> </span><br><span class="line">    <span class="tag"><<span class="name">NodeId</span>></span>255<span class="tag"></<span class="name">NodeId</span>></span> </span><br><span class="line">    <span class="tag"><<span class="name">NodeInstance</span>></span>CustomNodeInstanceName0<span class="tag"></<span class="name">NodeInstance</span>></span> </span><br><span class="line">    <span class="tag"><<span class="name">NodeInstanceId</span>></span>0<span class="tag"></<span class="name">NodeInstanceId</span>></span> </span><br><span class="line"><span class="tag"></<span class="name">Node</span>></span></span><br></pre></td></tr></tbody></table></figure>
</li>
</ol>
</li>
<li><p>portlinkages，节点间的链接列表。link，是节点间的单个链接，可以一对多</p>
<ol>
<li>srcPort是节点的输出端口，主要通过端口以及节点的名字和id来确定。</li>
<li>dstPort是节点的输入端口</li>
<li>bufferProperties描述了缓冲区的属性，主要有格式（BufferFormat），大小，初始分配的缓冲区数量（BufferImmediateAllocCount），最大缓冲区深度（BufferQueueDepth），从堆中分配分配缓冲区（bufferHeap），用于允许分配在摄像机ISP外部可见以及缓冲区的使用信息（BufferFlags）</li>
<li>linkProperties就只有BatchMode，是否需要批处理，通常只有在HFR模式才需要这样做，以允许ISP在单个硬件提交中处理多个帧。它只适用于无法脱机操作的链接。</li>
</ol>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag"><<span class="name">Link</span>></span> </span><br><span class="line">    <span class="tag"><<span class="name">SrcPort</span>></span> </span><br><span class="line">     <span class="tag"><<span class="name">PortName</span>></span>IFEOutputPortFull<span class="tag"></<span class="name">PortName</span>></span> </span><br><span class="line">        <span class="tag"><<span class="name">PortId</span>></span>0<span class="tag"></<span class="name">PortId</span>></span> </span><br><span class="line">        <span class="tag"><<span class="name">NodeName</span>></span>IFE<span class="tag"></<span class="name">NodeName</span>></span> </span><br><span class="line">        <span class="tag"><<span class="name">NodeId</span>></span>65536<span class="tag"></<span class="name">NodeId</span>></span> </span><br><span class="line">        <span class="tag"><<span class="name">NodeInstance</span>></span>IFEInstanceName0<span class="tag"></<span class="name">NodeInstance</span>></span> </span><br><span class="line">        <span class="tag"><<span class="name">NodeInstanceId</span>></span>0<span class="tag"></<span class="name">NodeInstanceId</span>></span> </span><br><span class="line">    <span class="tag"></<span class="name">SrcPort</span>></span> </span><br><span class="line">    <span class="tag"><<span class="name">DstPort</span>></span> </span><br><span class="line">        <span class="tag"><<span class="name">PortName</span>></span>IPEInputPortFull<span class="tag"></<span class="name">PortName</span>></span> </span><br><span class="line">        <span class="tag"><<span class="name">PortId</span>></span>0<span class="tag"></<span class="name">PortId</span>></span> </span><br><span class="line">        <span class="tag"><<span class="name">NodeName</span>></span>IPE<span class="tag"></<span class="name">NodeName</span>></span> </span><br><span class="line">        <span class="tag"><<span class="name">NodeId</span>></span>65538<span class="tag"></<span class="name">NodeId</span>></span> </span><br><span class="line">        <span class="tag"><<span class="name">NodeInstance</span>></span>IPEInstanceName0<span class="tag"></<span class="name">NodeInstance</span>></span> </span><br><span class="line">        <span class="tag"><<span class="name">NodeInstanceId</span>></span>0<span class="tag"></<span class="name">NodeInstanceId</span>></span> </span><br><span class="line">    <span class="tag"></<span class="name">DstPort</span>></span> </span><br><span class="line">    <span class="tag"><<span class="name">BufferProperties</span>></span> </span><br><span class="line">        <span class="tag"><<span class="name">BufferFormat</span>></span>ChiFormatYUV420NV12<span class="tag"></<span class="name">BufferFormat</span>></span> </span><br><span class="line">        <span class="tag"><<span class="name">BufferImmediateAllocCount</span>></span>8<span class="tag"></<span class="name">BufferImmediateAllocCount</span>></span> </span><br><span class="line">        <span class="tag"><<span class="name">BufferQueueDepth</span>></span>8<span class="tag"></<span class="name">BufferQueueDepth</span>></span> </span><br><span class="line">        <span class="tag"><<span class="name">BufferHeap</span>></span>Ion<span class="tag"></<span class="name">BufferHeap</span>></span> </span><br><span class="line">        <span class="tag"><<span class="name">BufferFlags</span>></span>BufferMemFlagHw<span class="tag"></<span class="name">BufferFlags</span>></span> </span><br><span class="line">    <span class="tag"></<span class="name">BufferProperties</span>></span> </span><br><span class="line"><span class="tag"></<span class="name">Link</span>></span></span><br></pre></td></tr></tbody></table></figure>




</li>
</ol>
</li>
</ol>
<h2 id="（三）CHI-架构模型"><a href="#（三）CHI-架构模型" class="headerlink" title="（三）CHI 架构模型"></a>（三）CHI 架构模型</h2><h3 id="overview"><a href="#overview" class="headerlink" title="overview"></a>overview</h3><p><img src="https://image.qinxing.xyz/20200515101014.png" alt="CHI框架"></p>
<h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><p><img src="https://image.qinxing.xyz/20200514190636.png" alt="初始化"></p>
<p>JAVA层通过open的函数获得了CHI的所有操作函数，这是通过chi_hal_override_entry()方法获取的。</p>
<p>接着用configure_stream配置流，CHI框架在其中的操作是初始化了会话session，找到配置对应的pipeline，并返回了一个pipeline的句柄。（框架为自定义会话和后处理预留了接口，返回NULL是用高通默认的pipeline）</p>
<p><img src="https://image.qinxing.xyz/20200514190631.png" alt="请求与返回流程"></p>
<p>用process_capture_request去请求图像数据（包括抓拍，录像和预览），这个请求会提交到pipeline中，接着pipeline中的各个节点都会得到请求的通知，进行对应的执行。当然这一步也可以重写请求，比如说为多帧特性创建额外的请求。</p>
<p>每个管道都会异步执行，来自任何管道的结果，包括实时流和离线流，都会通知CHI层。如果CHI为JAVA层的请求生成了多个子请求，那么需要等到所有结果都触发之后再调用chi_override_process_pipeline_result，把结果转发到HAL，最终转发给camera框架中的process_capture_result。 高通框架支持重写结果通知部分。</p>
<p><img src="https://image.qinxing.xyz/20200515094211.png" alt="close 流程"></p>
<p>当HAL收到camera框架的close调用时，它调用chi_teardown_override_session，然后必须清理所有的自定义管道和会话。</p>
<h3 id="元数据metadata"><a href="#元数据metadata" class="headerlink" title="元数据metadata"></a>元数据metadata</h3><p>CHI中的沟通渠道分为以下几个：</p>
<ul>
<li><p>传给APP的数据</p>
</li>
<li><p>传给后处理pipeline的数据</p>
</li>
<li><p>使用发布和订阅机制的节点通信（这是很有名的一种设计模式）</p>
<ul>
<li>原生节点之间用android tags/chiVendorTags</li>
<li>原生节点和自定义节点，以及自定义节点之间用android tags/chiVendorTags/ExtCompVendorTags </li>
</ul>
</li>
</ul>
<p>元数据标签可以是预定义的Android标签，也可以是定制的厂商标签。元数据标签使内部和外部的组件可以相互通信，也可以与面向应用程序的摄像头API通信。在CHI中，Android元数据标签是预定义的，只接收不可变的值。厂商标记不能静态地与固定的绝对值关联。根据目标上扩展组件的数量和类型，CHI使用厂商标记的动态索引(base  + offset)使组件能够相互通信。</p>
<p>元数据标记ID是一个32位的值，它被限制在一个特定的部分中。每个部分的起始偏移量为0x1_0000。标记空间的范围从0x0000_0000到0x8000_0000是为Android元数据标记保留的。供应商部分应该在0x8000_0000之后开始。</p>
<p>在初始化时，当CHI扫描目标系统中的可用组件时，它为每个发布自定义厂商标记的组件分配一个厂商部分的开始位置。组件需要枚举标记为Base + Offset,  Base由CHI分配</p>
<p><img src="https://image.qinxing.xyz/20200515110540.png" alt="metadata 存储位置"></p>
<p>节点可以通过设置初始化时枚举过的标记来发布元数据。CHI会根据特定标记的依赖关系，通知所有其他提交的节点。这个机制对于Android标签、ChiVendorTags或其他ExtCompVendorTags都是一样的。</p>
<p><img src="https://image.qinxing.xyz/20200515110543.png" alt="节点间通信流程图"></p>
<h2 id="（四）代码细节"><a href="#（四）代码细节" class="headerlink" title="（四）代码细节"></a>（四）代码细节</h2><h3 id="1-加载外部二进制库"><a href="#1-加载外部二进制库" class="headerlink" title="1. 加载外部二进制库"></a>1. 加载外部二进制库</h3><p>每个节点都必须在一起单独的动态库里面，按照com.< cendor >, < category >, < algorithm > .so的方式命名。</p>
<p>< vendor >：公司名</p>
<p>< category >：模块的类型，可以是node或者stats</p>
<p>< algorithm > ： 算法独特的名字，如果说节点，名字必须和xml指定的名称匹配。如果是stats，只能是af, aec, awb, asd, afd里面的一个。</p>
<p>所有的动态库都放在 <code>/sys/data/camx/components/</code></p>
<p>相机服务的初始化，发生在设备启动的时候，加载HAL3模块的CHI实现。在CHI HAL3的启动过程中，驱动城市查询并加载位于这个路径下的所有动态库。</p>
<h3 id="2-CHI-接口"><a href="#2-CHI-接口" class="headerlink" title="2. CHI 接口"></a>2. CHI 接口</h3><p>CHI向HAL3接口添加了一些关键元素，以支持更细粒度的控制，以下函数用于访问CHI驱动程序，他们对Camera2/HAL3没有任何依赖。</p>
<p>ChiEntry()是CHI驱动程序的主要入口点，所有CHI功能都需要。</p>
<p>其中使用了ChiContextOps 结构体指向所有的CHI函数。客户端需要使用有效的CHIIHandle句柄来调用这些函数，这个结构体永远不会缩小，现有字段也不会在结构更改时重新排序或者重新使用。所有字段默认值是0，0代表了这个特性不可用。</p>
<p>CHI 接口的函数中比较重要的是pOpenContext。通过这个函数打开CHI的上下文，并将句柄返回给CHI。这个函数必须在任何其他CHI函数之前调用。</p>
<p>这个函数是用来创建chicontext的唯一实例，chicontext是会话中所有状态都保留的地方，预计每个进程中将会有一个Chicontext，当然，一个进程中有多个chicontext也是支持的。在chicontext之间没有交互信息的机制，会话和pipeline只能被创建它的chicontext使用。</p>
<h3 id="3-HAL3到CHI-重写接口（override）"><a href="#3-HAL3到CHI-重写接口（override）" class="headerlink" title="3. HAL3到CHI 重写接口（override）"></a>3. HAL3到CHI 重写接口（override）</h3><p>如果CHI功能用于HAL3相机应用程序，这些功能必须在OEM重写代码中实现。这些函数必须被编译到一个名为com.< vendor > .chi.override.so的文件中。</p>
<p>chi_hal_override_entry()</p>
<p>由驱动程序调用来初始化HAL重写模块的入口点。为了让驱动程序初始化override接口，com.< vendor > .chi.override.so必须导出这个函数。该函数在相机服务器初始化期间调用，初始化发生在设备引导期间。</p>
<h3 id="4-CHI-节点接口"><a href="#4-CHI-节点接口" class="headerlink" title="4. CHI 节点接口"></a>4. CHI 节点接口</h3><p>ChiNodeEntry() ：由CHI驱动程序调用来初始化自定义节点的入口点。</p>
<p>ChiNodeCallbacks结构体：</p>
<table>
<thead>
<tr>
<th>size</th>
<th>结构的大小，这个值框架会自己计算的</th>
</tr>
</thead>
<tbody><tr>
<td>majorVersion/minorVersion</td>
<td>版本号</td>
</tr>
<tr>
<td>pGetCapabilities</td>
<td>必填，能力集，mask列表在chinode.h中查找</td>
</tr>
<tr>
<td>pQueryVendorTag</td>
<td>如果节点需要到处vendor标记才填充它</td>
</tr>
<tr>
<td>pCreate</td>
<td>必填，当拓扑图创建时创建节点实例</td>
</tr>
<tr>
<td>pDestory</td>
<td>必填，当拓扑图销毁是销毁节点实例</td>
</tr>
<tr>
<td>pQueryBufferInfo</td>
<td>必填，CHI调用这个函数从节点查询特定输出格式的输入缓冲区格式(分辨率和类型)</td>
</tr>
<tr>
<td>pSetBufferInfo</td>
<td>必填，CHI设置缓冲区格式</td>
</tr>
<tr>
<td>pProcessRequest</td>
<td>必填，执行请求处理。</td>
</tr>
<tr>
<td>pChiNodeSetNodeInterface</td>
<td>必填，设置节点中的预定义CHI接口</td>
</tr>
<tr>
<td>pPipelineCreated</td>
<td>可选，CHI通知节点创建了一个特定的pipeline</td>
</tr>
<tr>
<td>pPostPipelineCreate</td>
<td>后管道创建的通知</td>
</tr>
<tr>
<td>pPrepareStreamOn/pOnStreamOn/pOnStreamOff</td>
<td>事件通知</td>
</tr>
<tr>
<td>pQueryMetadataPublishList</td>
<td>必须调用此函数来查询节点发布的元数据列表。</td>
</tr>
<tr>
<td>pFlushRequest</td>
<td>释放为请求分配的节点资源。</td>
</tr>
<tr>
<td>pGetFlushResponse</td>
<td>获取刷新调用的最坏情况响应时间</td>
</tr>
<tr>
<td>pFillHwdata</td>
<td>填充每个请求的硬件数据</td>
</tr>
</tbody></table>
<h3 id="5-CHI-stats-重写"><a href="#5-CHI-stats-重写" class="headerlink" title="5. CHI stats 重写"></a>5. CHI stats 重写</h3><p>有AE, AWB, AF, HAF(混合自动对焦)，PDAF，Auto Flicker Detection（水波纹检测），Auto Scene Detection（场景识别），Tracker （对象触摸跟踪）算法的接口，可以自己实现（高通的算法还是很复杂和高级的，正常人不会修改）</p>
</body></html></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">xiaoqinxing</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.qinxing.xyz/posts/8b80089f/">https://www.qinxing.xyz/posts/8b80089f/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.qinxing.xyz" target="_blank">清新的日子</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BC%96%E7%A8%8B/">编程</a><a class="post-meta__tags" href="/tags/%E9%AB%98%E9%80%9A/">高通</a><a class="post-meta__tags" href="/tags/camx/">camx</a></div><div class="post_share"><div class="social-share" data-image="https://image.qinxing.xyz/20200513145157.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付寶"/></a><div class="post-qr-code-desc">支付寶</div></li></ul></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/8da2c999/"><img class="prev-cover" src="https://image.qinxing.xyz/20200520233103.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ISP算法之3D降噪算法实现</div></div></a></div><div class="next-post pull-right"><a href="/posts/19376693/"><img class="next-cover" src="https://image.qinxing.xyz/20200508095727.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">chromatix调试问题汇总</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/2d82b27c/" title="高通代码学习与体会"><img class="cover" src="https://image.qinxing.xyz/20200318232730.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-02-20</div><div class="title">高通代码学习与体会</div></div></a></div><div><a href="/posts/e2f4e564/" title="flutter 注意事项和总结"><img class="cover" src="https://image.qinxing.xyz/20200331235105.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-07-25</div><div class="title">flutter 注意事项和总结</div></div></a></div><div><a href="/posts/48b9801d/" title="aec重载chromatix功能实现"><img class="cover" src="https://image.qinxing.xyz/20200317001133.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-03-07</div><div class="title">aec重载chromatix功能实现</div></div></a></div><div><a href="/posts/80ca7941/" title="递归函数设计"><img class="cover" src="https://image.qinxing.xyz/20200318222128.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-02-27</div><div class="title">递归函数设计</div></div></a></div><div><a href="/posts/8f9bdbcd/" title="c++ 二维数组参数传递"><img class="cover" src="https://cdn.yiban.io/pixabay/90978098cfa14c9ce869ba1d6e81b442a1fbe7ee2b7588bd22f3bcd79726b6c7.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-02-27</div><div class="title">c++ 二维数组参数传递</div></div></a></div><div><a href="/posts/1793d0bf/" title="c++ private外部访问问题"><img class="cover" src="https://image.qinxing.xyz/20200323002712.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-02-20</div><div class="title">c++ private外部访问问题</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></article></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2021 By xiaoqinxing</div><div class="footer_custom_text"><a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target="_blank" rel="nofollow"><img src="/img/又拍云_logo6.png" alt="CDN赞助商" style="max-height:2em"></a></div><div class="icp"><a href="http://www.beian.miit.gov.cn/" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"/><span>苏ICP备20006733号</span></a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    $.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js', function () {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script><script>function loadValine () {
  function initValine () {
    const initData = {
      el: '#vcomment',
      appId: '2pB7a7KQi6qQhvy3lVryrecn-gzGzoHsz',
      appKey: 'CGbafSzCCsV7hW2NbXXSEjRM',
      placeholder: '快来留言吧~\r\n昵称里面填qq号，可以自动出现昵称和邮箱~',
      avatar: 'wavatar',
      meta: 'nick,mail'.split(','),
      pageSize: '10',
      lang: 'zh-cn',
      recordIP: false,
      serverURLs: 'https://valine.qinxing.xyz',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }

    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script>(function(){
  const bp = document.createElement('script');
  const curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https'){
  bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  bp.dataset.pjax = ''
  const s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})()</script></div></body></html>